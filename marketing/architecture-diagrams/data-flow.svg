<?xml version="1.0" encoding="UTF-8"?>
<svg width="1400" height="900" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="flowGrad1" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#3498DB;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#2980B9;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="flowGrad2" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#E74C3C;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#C0392B;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="flowGrad3" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#2ECC71;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#27AE60;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="flowGrad4" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#F39C12;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#E67E22;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="flowGrad5" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#9B59B6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#8E44AD;stop-opacity:1" />
    </linearGradient>
  </defs>

  <!-- Title -->
  <text x="700" y="40" font-family="Arial, sans-serif" font-size="32" font-weight="bold" text-anchor="middle" fill="#2C3E50">
    HPA Autoscaler Data Flow &amp; Decision Process
  </text>

  <!-- Phase 1: Metric Collection -->
  <g>
    <rect x="50" y="80" width="300" height="150" fill="url(#flowGrad1)" stroke="#2980B9" stroke-width="3" rx="10"/>
    <text x="200" y="110" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="white">
      1. Metric Collection
    </text>
    
    <circle cx="120" cy="150" r="25" fill="white" stroke="#2980B9" stroke-width="2"/>
    <text x="120" y="155" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#2980B9">
      CPU/MEM
    </text>
    
    <circle cx="200" cy="150" r="25" fill="white" stroke="#2980B9" stroke-width="2"/>
    <text x="200" y="155" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#2980B9">
      Kafka
    </text>
    
    <circle cx="280" cy="150" r="25" fill="white" stroke="#2980B9" stroke-width="2"/>
    <text x="280" y="155" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#2980B9">
      Custom
    </text>
    
    <rect x="70" y="185" width="260" height="35" fill="white" stroke="#2980B9" stroke-width="1" rx="5"/>
    <text x="200" y="198" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#2980B9">
      Resource Collectors, External APIs,
    </text>
    <text x="200" y="213" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#2980B9">
      Prometheus, Nginx Status, CEL Expressions
    </text>
  </g>

  <!-- Phase 2: Metric Processing -->
  <g>
    <rect x="400" y="80" width="300" height="150" fill="url(#flowGrad2)" stroke="#C0392B" stroke-width="3" rx="10"/>
    <text x="550" y="110" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="white">
      2. Metric Processing
    </text>
    
    <rect x="420" y="130" width="100" height="40" fill="white" stroke="#C0392B" stroke-width="1" rx="5"/>
    <text x="470" y="145" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#C0392B">
      Aggregation
    </text>
    <text x="470" y="160" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#C0392B">
      Average, Max, Min
    </text>
    
    <rect x="540" y="130" width="100" height="40" fill="white" stroke="#C0392B" stroke-width="1" rx="5"/>
    <text x="590" y="145" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#C0392B">
      Normalization
    </text>
    <text x="590" y="160" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#C0392B">
      Units, Scale
    </text>
    
    <rect x="420" y="180" width="220" height="40" fill="white" stroke="#C0392B" stroke-width="1" rx="5"/>
    <text x="530" y="195" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#C0392B">
      Threshold Comparison &amp; CEL Evaluation
    </text>
    <text x="530" y="210" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#C0392B">
      Apply business logic and custom expressions
    </text>
  </g>

  <!-- Phase 3: Scaling Decision -->
  <g>
    <rect x="750" y="80" width="300" height="150" fill="url(#flowGrad3)" stroke="#27AE60" stroke-width="3" rx="10"/>
    <text x="900" y="110" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="white">
      3. Scaling Decision
    </text>
    
    <rect x="770" y="130" width="80" height="35" fill="white" stroke="#27AE60" stroke-width="1" rx="5"/>
    <text x="810" y="145" font-family="Arial, sans-serif" font-size="9" font-weight="bold" text-anchor="middle" fill="#27AE60">
      Scale Up
    </text>
    <text x="810" y="157" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#27AE60">
      Demand ↑
    </text>
    
    <rect x="860" y="130" width="80" height="35" fill="white" stroke="#27AE60" stroke-width="1" rx="5"/>
    <text x="900" y="145" font-family="Arial, sans-serif" font-size="9" font-weight="bold" text-anchor="middle" fill="#27AE60">
      No Change
    </text>
    <text x="900" y="157" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#27AE60">
      Stable
    </text>
    
    <rect x="950" y="130" width="80" height="35" fill="white" stroke="#27AE60" stroke-width="1" rx="5"/>
    <text x="990" y="145" font-family="Arial, sans-serif" font-size="9" font-weight="bold" text-anchor="middle" fill="#27AE60">
      Scale Down
    </text>
    <text x="990" y="157" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#27AE60">
      Demand ↓
    </text>
    
    <rect x="770" y="175" width="260" height="45" fill="white" stroke="#27AE60" stroke-width="1" rx="5"/>
    <text x="900" y="190" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#27AE60">
      Safety Checks &amp; Policy Validation
    </text>
    <text x="900" y="203" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#27AE60">
      PDB compliance, HPA conflicts, rate limits,
    </text>
    <text x="900" y="216" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#27AE60">
      cooldown periods, max scale percentages
    </text>
  </g>

  <!-- Phase 4: Execution -->
  <g>
    <rect x="1100" y="80" width="250" height="150" fill="url(#flowGrad4)" stroke="#E67E22" stroke-width="3" rx="10"/>
    <text x="1225" y="110" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="white">
      4. Execution
    </text>
    
    <rect x="1120" y="130" width="100" height="40" fill="white" stroke="#E67E22" stroke-width="1" rx="5"/>
    <text x="1170" y="145" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#E67E22">
      API Call
    </text>
    <text x="1170" y="160" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#E67E22">
      Scale Target
    </text>
    
    <rect x="1230" y="130" width="100" height="40" fill="white" stroke="#E67E22" stroke-width="1" rx="5"/>
    <text x="1280" y="145" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#E67E22">
      Update CRD
    </text>
    <text x="1280" y="160" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#E67E22">
      Status/Events
    </text>
    
    <rect x="1120" y="180" width="210" height="40" fill="white" stroke="#E67E22" stroke-width="1" rx="5"/>
    <text x="1225" y="195" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#E67E22">
      Webhook Notifications &amp; Audit Logging
    </text>
    <text x="1225" y="210" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#E67E22">
      Admission controllers, event streams
    </text>
  </g>

  <!-- Advanced Features Section -->
  <g>
    <rect x="50" y="280" width="1300" height="200" fill="url(#flowGrad5)" stroke="#8E44AD" stroke-width="3" rx="10"/>
    <text x="700" y="310" font-family="Arial, sans-serif" font-size="20" font-weight="bold" text-anchor="middle" fill="white">
      Advanced Features &amp; Intelligence
    </text>
    
    <!-- Predictive Scaling -->
    <rect x="80" y="330" width="200" height="120" fill="white" stroke="#8E44AD" stroke-width="2" rx="8"/>
    <text x="180" y="355" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#8E44AD">
      Predictive Scaling
    </text>
    <text x="180" y="375" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#8E44AD">
      • Machine learning models
    </text>
    <text x="180" y="390" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#8E44AD">
      • Historical pattern analysis
    </text>
    <text x="180" y="405" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#8E44AD">
      • Future demand forecasting
    </text>
    <text x="180" y="420" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#8E44AD">
      • Proactive scaling actions
    </text>
    <text x="180" y="435" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#8E44AD">
      • Confidence thresholds
    </text>

    <!-- Cost Optimization -->
    <rect x="300" y="330" width="200" height="120" fill="white" stroke="#8E44AD" stroke-width="2" rx="8"/>
    <text x="400" y="355" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#8E44AD">
      Cost Optimization
    </text>
    <text x="400" y="375" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#8E44AD">
      • Spot instance management
    </text>
    <text x="400" y="390" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#8E44AD">
      • Cost-aware scaling policies
    </text>
    <text x="400" y="405" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#8E44AD">
      • Resource efficiency metrics
    </text>
    <text x="400" y="420" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#8E44AD">
      • Budget constraints
    </text>
    <text x="400" y="435" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#8E44AD">
      • ROI optimization
    </text>

    <!-- Multi-Scaler Support -->
    <rect x="520" y="330" width="200" height="120" fill="white" stroke="#8E44AD" stroke-width="2" rx="8"/>
    <text x="620" y="355" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#8E44AD">
      Multi-Scaler Support
    </text>
    <text x="620" y="375" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#8E44AD">
      • Kafka consumer lag
    </text>
    <text x="620" y="390" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#8E44AD">
      • Prometheus PromQL queries
    </text>
    <text x="620" y="405" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#8E44AD">
      • Custom CEL expressions
    </text>
    <text x="620" y="420" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#8E44AD">
      • Nginx status metrics
    </text>
    <text x="620" y="435" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#8E44AD">
      • External API integration
    </text>

    <!-- Real-time Processing -->
    <rect x="740" y="330" width="200" height="120" fill="white" stroke="#8E44AD" stroke-width="2" rx="8"/>
    <text x="840" y="355" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#8E44AD">
      Real-time Processing
    </text>
    <text x="840" y="375" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#8E44AD">
      • gRPC bidirectional streaming
    </text>
    <text x="840" y="390" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#8E44AD">
      • Sub-second response times
    </text>
    <text x="840" y="405" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#8E44AD">
      • Event-driven architecture
    </text>
    <text x="840" y="420" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#8E44AD">
      • Kubernetes watch API
    </text>
    <text x="840" y="435" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#8E44AD">
      • Continuous monitoring
    </text>

    <!-- Security & Compliance -->
    <rect x="960" y="330" width="200" height="120" fill="white" stroke="#8E44AD" stroke-width="2" rx="8"/>
    <text x="1060" y="355" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#8E44AD">
      Security &amp; Compliance
    </text>
    <text x="1060" y="375" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#8E44AD">
      • mTLS authentication
    </text>
    <text x="1060" y="390" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#8E44AD">
      • RBAC integration
    </text>
    <text x="1060" y="405" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#8E44AD">
      • Multi-tenant isolation
    </text>
    <text x="1060" y="420" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#8E44AD">
      • Admission webhooks
    </text>
    <text x="1060" y="435" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#8E44AD">
      • Audit logging
    </text>

    <!-- Observability -->
    <rect x="1180" y="330" width="150" height="120" fill="white" stroke="#8E44AD" stroke-width="2" rx="8"/>
    <text x="1255" y="355" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#8E44AD">
      Observability
    </text>
    <text x="1255" y="375" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#8E44AD">
      • Prometheus metrics
    </text>
    <text x="1255" y="390" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#8E44AD">
      • Grafana dashboards
    </text>
    <text x="1255" y="405" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#8E44AD">
      • Distributed tracing
    </text>
    <text x="1255" y="420" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#8E44AD">
      • Event logging
    </text>
    <text x="1255" y="435" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#8E44AD">
      • Health monitoring
    </text>
  </g>

  <!-- Data Flow Timeline -->
  <g>
    <rect x="50" y="520" width="1300" height="180" fill="#F8F9FA" stroke="#6C757D" stroke-width="2" rx="10"/>
    <text x="700" y="550" font-family="Arial, sans-serif" font-size="20" font-weight="bold" text-anchor="middle" fill="#2C3E50">
      Scaling Decision Timeline
    </text>
    
    <!-- Timeline -->
    <line x1="100" y1="580" x2="1300" y2="580" stroke="#2C3E50" stroke-width="3"/>
    
    <!-- Time markers -->
    <circle cx="150" cy="580" r="8" fill="#3498DB"/>
    <text x="150" y="605" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#2C3E50">T+0s</text>
    <text x="150" y="620" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#2C3E50">Metric</text>
    <text x="150" y="635" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#2C3E50">Collection</text>
    
    <circle cx="350" cy="580" r="8" fill="#E74C3C"/>
    <text x="350" y="605" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#2C3E50">T+0.1s</text>
    <text x="350" y="620" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#2C3E50">Processing</text>
    <text x="350" y="635" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#2C3E50">&amp; Analysis</text>
    
    <circle cx="550" cy="580" r="8" fill="#2ECC71"/>
    <text x="550" y="605" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#2C3E50">T+0.2s</text>
    <text x="550" y="620" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#2C3E50">Decision</text>
    <text x="550" y="635" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#2C3E50">Engine</text>
    
    <circle cx="750" cy="580" r="8" fill="#F39C12"/>
    <text x="750" y="605" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#2C3E50">T+0.3s</text>
    <text x="750" y="620" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#2C3E50">Safety</text>
    <text x="750" y="635" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#2C3E50">Validation</text>
    
    <circle cx="950" cy="580" r="8" fill="#9B59B6"/>
    <text x="950" y="605" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#2C3E50">T+0.5s</text>
    <text x="950" y="620" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#2C3E50">API</text>
    <text x="950" y="635" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#2C3E50">Execution</text>
    
    <circle cx="1150" cy="580" r="8" fill="#34495E"/>
    <text x="1150" y="605" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="#2C3E50">T+2-5s</text>
    <text x="1150" y="620" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#2C3E50">Pod</text>
    <text x="1150" y="635" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#2C3E50">Lifecycle</text>
    
    <!-- Performance indicators -->
    <rect x="100" y="650" width="300" height="30" fill="#D5EDDA" stroke="#155724" stroke-width="1" rx="5"/>
    <text x="250" y="670" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#155724">
      Sub-second decision making (&lt;500ms typical)
    </text>
    
    <rect x="450" y="650" width="300" height="30" fill="#CCE5FF" stroke="#0066CC" stroke-width="1" rx="5"/>
    <text x="600" y="670" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#0066CC">
      99.9% availability with automatic failover
    </text>
    
    <rect x="800" y="650" width="300" height="30" fill="#FFF3CD" stroke="#856404" stroke-width="1" rx="5"/>
    <text x="950" y="670" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#856404">
      Multi-cluster coordination &amp; global policies
    </text>
  </g>

  <!-- Flow arrows -->
  <defs>
    <marker id="flowArrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <path d="M0,0 L0,6 L9,3 z" fill="#2C3E50"/>
    </marker>
  </defs>
  
  <!-- Main flow arrows -->
  <path d="M 350 155 L 400 155" stroke="#2C3E50" stroke-width="4" fill="none" marker-end="url(#flowArrow)"/>
  <path d="M 700 155 L 750 155" stroke="#2C3E50" stroke-width="4" fill="none" marker-end="url(#flowArrow)"/>
  <path d="M 1050 155 L 1100 155" stroke="#2C3E50" stroke-width="4" fill="none" marker-end="url(#flowArrow)"/>
  
  <!-- Feedback loops -->
  <path d="M 1225 230 Q 1350 300 1300 400 Q 1250 500 900 450 Q 550 400 200 350 Q 100 320 150 280" 
        stroke="#8E44AD" stroke-width="3" stroke-dasharray="8,4" fill="none" marker-end="url(#flowArrow)"/>
  <text x="700" y="720" font-family="Arial, sans-serif" font-size="12" font-style="italic" text-anchor="middle" fill="#8E44AD">
    Continuous feedback loop for learning and optimization
  </text>

  <!-- Legend for timeline -->
  <rect x="50" y="750" width="1300" height="100" fill="#FFF" stroke="#000" stroke-width="1" rx="5"/>
  <text x="700" y="780" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="#2C3E50">
    Key Performance Indicators
  </text>
  
  <text x="100" y="810" font-family="Arial, sans-serif" font-size="12" fill="#2C3E50">• <tspan font-weight="bold">Metric Collection Frequency:</tspan> Every 15-30 seconds (configurable)</text>
  <text x="100" y="830" font-family="Arial, sans-serif" font-size="12" fill="#2C3E50">• <tspan font-weight="bold">Decision Latency:</tspan> &lt;500ms from metric to scaling decision</text>
  
  <text x="700" y="810" font-family="Arial, sans-serif" font-size="12" fill="#2C3E50">• <tspan font-weight="bold">Scaling Throughput:</tspan> 1000+ scaling decisions per minute</text>
  <text x="700" y="830" font-family="Arial, sans-serif" font-size="12" fill="#2C3E50">• <tspan font-weight="bold">Safety Override Rate:</tspan> &lt;0.1% false positives</text>
</svg>